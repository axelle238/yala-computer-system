<?php

namespace App\Livewire\Security;

use Livewire\Attributes\Layout;
use Livewire\Attributes\Title;
use Livewire\Component;

#[Layout('layouts.admin')]
#[Title('Pemindai Kerentanan Sistem')]
class VulnerabilityScan extends Component
{
    public $isScanning = false;

    public $progress = 0;

    public $scanResults = [];

    public $lastScanDate;

    public function startScan()
    {
        $this->isScanning = true;
        $this->progress = 0;
        $this->scanResults = [];
    }

    public function scanning()
    {
        if ($this->isScanning) {
            $this->progress += 10;
            if ($this->progress >= 100) {
                $this->finishScan();
            }
        }
    }

    public function finishScan()
    {
        $this->isScanning = false;
        $this->lastScanDate = now();
        $this->scanResults = [
            ['severity' => 'Low', 'title' => 'Missing CSP Header', 'description' => 'Content-Security-Policy header is missing.'],
            ['severity' => 'Medium', 'title' => 'Outdated NPM Packages', 'description' => 'Some frontend dependencies need updates.'],
            ['severity' => 'Safe', 'title' => 'Database Permissions', 'description' => 'Database user permissions are correctly scoped.'],
            ['severity' => 'Safe', 'title' => 'File Permissions', 'description' => 'Storage directory permissions are secure.'],
        ];
        $this->dispatch('notify', message: 'Pemindaian selesai.', type: 'success');
    }

    public function render()
    {
        return view('livewire.security.vulnerability-scan');
    }
}
